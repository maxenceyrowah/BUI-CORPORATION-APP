<div class="flex flex-col p-4 sm:p-6 md:p-8 lg:p-12">
  <div class="overflow-x-auto">
    <div class="min-w-full inline-block align-middle">

      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6">
        <div class="mb-4 sm:mb-0">
          <p class="text-xl sm:text-2xl font-bold">Liste des tâches</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto">
          <button mat-flat-button class="w-full sm:w-auto rounded-[8px]" (click)="openAddTask()">Ajouter une
            tâche</button>
          <button mat-raised-button class="w-full sm:w-auto rounded-[8px]" (click)="logout()">Se déconnecter</button>
        </div>
      </div>

      <div class="flex">
        <app-form-field label="Filtre des tâches">
          <div ngProjectAs="[field-content]">
            <mat-form-field appearance="outline">
              <mat-select [formControl]="taskStatutSelected">
                @for (taskFiltered of filteredTasks; track taskFiltered) {
                <mat-option [value]="taskFiltered.value">{{taskFiltered.label}}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </app-form-field>
      </div>

      <div class="overflow-hidden">
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg max-h-[350px] sm:max-h-[450px]">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 z-10">
              <tr>
                @for (item of displayedColumns; track item) {
                <th scope="col" [ngClass]="{ 'text-right': item === 'actions'}"
                  class="px-3 py-2 sm:px-6 sm:py-3 font-semibold capitalize rounded-t-lg">
                  {{ displayHeader(item) | uppercase }}
                </th>
                }
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              @for (task of (filteredTasks$ | async) ?? []; track task?._id) {
              <tr class="bg-white hover:bg-gray-50 transition-colors duration-200">
                <td class="px-3 py-2 sm:px-6 sm:py-4 font-medium text-gray-900 whitespace-nowrap">
                  <input *ngIf="task.isEditing" [(ngModel)]="task.task_name"
                    class="w-full p-1 sm:p-2 border rounded text-sm" />
                  <span *ngIf="!task.isEditing" class="text-sm sm:text-base">{{ task.task_name }}</span>
                </td>

                <td class="px-3 py-2 sm:px-6 sm:py-4 font-medium text-gray-900 whitespace-nowrap">
                  <select *ngIf="task.isEditing" [(ngModel)]="task.statut"
                    class="w-full p-1 sm:p-2 border rounded text-sm">
                    <option *ngFor="let option of options" [value]="option.value">{{ option.label }}</option>
                  </select>
                  <span *ngIf="!task.isEditing" class="text-sm sm:text-base">{{
                    adaptiveStatutLabel(task.statut)}}</span>
                </td>

                <td class="px-3 py-2 sm:px-6 sm:py-4 text-right">
                  @if(!task.isEditing) {
                  <button mat-icon-button matTooltip="Editer" (click)="editField(task)"
                    class="text-blue-500 hover:text-blue-700">
                    <mat-icon class="text-base sm:text-lg">edit</mat-icon>
                  </button>
                  <button mat-icon-button matTooltip="Supprimer" (click)="deleteTask(task)"
                    class="text-blue-500 hover:text-blue-700">
                    <mat-icon class="text-base sm:text-lg">delete</mat-icon>
                  </button>
                  }
                  @if(task.isEditing) {
                  <button mat-icon-button matTooltip="Enregistrer" (click)="saveField(task)"
                    class="text-green-500 hover:text-green-700" [disabled]="isSubmitting()">
                    <mat-icon *ngIf="!isSubmitting()" class="text-base sm:text-lg">save</mat-icon>
                    <mat-progress-spinner *ngIf="isSubmitting()" [diameter]="20"
                      [mode]="'indeterminate'"></mat-progress-spinner>
                  </button>
                  <button mat-icon-button matTooltip="Annuler" (click)="cancelEditField(task)"
                    [disabled]="isSubmitting()" class="text-red-500 hover:text-red-700">
                    <mat-icon class="text-base sm:text-lg">close</mat-icon>
                  </button>
                  }
                </td>
              </tr>
              }

              @if(!allTasks.length) {
              <tr>
                <td colspan="3" class="px-3 py-2 sm:px-6 sm:py-4 text-center text-gray-500 text-sm sm:text-base">
                  Aucune tâche disponible.
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        <div class="mt-3 sm:mt-5 shadow-md text-right p-2 sm:p-4">
          <span class="text-sm sm:text-base">Nombre de tâches incomplètes: <span
              class="text-blue-500">{{uncompletedTasksNumber}}</span></span>
        </div>
      </div>
    </div>
  </div>
</div>